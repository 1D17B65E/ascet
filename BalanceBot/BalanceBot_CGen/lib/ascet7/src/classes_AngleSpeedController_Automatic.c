/******************************************************************************
 * DO NOT EDIT!
 * AUTOMATICALLY GENERATED BY:..ASCET-DEVELOPER 7.9.0
 * CODE GENERATOR:..............6.4.7
 * COMPONENT:...................classes.AngleSpeedController
 * REPRESENTATION:..............Automatic
 * DESCRIPTION:
 *    
 ******************************************************************************/


/*-----------------------------------------------------------------------------
 *    Defines
 *----------------------------------------------------------------------------*/

#define __ASD_REQUIRES_OS_INFACE

/*-----------------------------------------------------------------------------
 *    Include files
 *----------------------------------------------------------------------------*/

#include "classes_AngleSpeedController_Automatic.h"
#include "BalanceBot_Automatic.h"
#include "interfaces_IBalance2WD_Automatic.h"
#include "interfaces_IParameters_Automatic.h"


/******************************************************************************
 * BEGIN: DEFINITION OF SUBSTRUCT VARIABLE 'classes_AngleSpeedController_RAM'
 * ----------------------------------------------------------------------------
 * memory class:.................................'RAM'
 * model name:...................................'classes_AngleSpeedController'
 * data set:.....................................'CLASSES_ANGLESPEEDCONTROLLER_AUTOMATIC_esdl_Data_Default'
 * ---------------------------------------------------------------------------*/
struct classes_AngleSpeedController_Automatic_RAM_SUBSTRUCT classes_AngleSpeedController_RAM = {
   /* struct element:'classes_AngleSpeedController_RAM.currentAngle' (modeled as:'currentAngle.classes_AngleSpeedController') */
   0.0F,
   /* struct element:'classes_AngleSpeedController_RAM.errorAngleSum' (modeled as:'errorAngleSum.classes_AngleSpeedController') */
   0.0F,
   /* struct element:'classes_AngleSpeedController_RAM.prevAngle' (modeled as:'prevAngle.classes_AngleSpeedController') */
   0.0F,
   /* substruct: classes_AngleSpeedController_RAM.IntegratorKLimited_instance (modeled as:'IntegratorKLimited_instance.classes_AngleSpeedController') */
   {
      /* struct element:'classes_AngleSpeedController_RAM.IntegratorKLimited_instance.memory' (modeled as:'memory.IntegratorKLimited_instance.classes_AngleSpeedController') */
      0.0F
   }
};
/* ----------------------------------------------------------------------------
 * END: DEFINITION OF SUBSTRUCT VARIABLE 'classes_AngleSpeedController_RAM'
 ******************************************************************************/

/******************************************************************************
 * BEGIN: DEFINITION OF COMPONENT VARIABLE 'classes_AngleSpeedController'
 * ----------------------------------------------------------------------------
 * memory class:.................................'ROM'
 * model name:...................................'classes_AngleSpeedController'
 * data set:.....................................'CLASSES_ANGLESPEEDCONTROLLER_AUTOMATIC_esdl_Data_Default'
 * ---------------------------------------------------------------------------*/
const struct classes_AngleSpeedController_Automatic classes_AngleSpeedController = {
   /* substruct: classes_AngleSpeedController.IntegratorKLimited_instance (modeled as:'IntegratorKLimited_instance.classes_AngleSpeedController') */
   {
      /* type descriptor pointer 'SystemLib_Transferfunction_Integrator_IntegratorKLimited_Automatic_RAM' for memory class substruct for 'RAM' */
      &classes_AngleSpeedController_RAM.IntegratorKLimited_instance
   }
};
/* ----------------------------------------------------------------------------
 * END: DEFINITION OF COMPONENT VARIABLE 'classes_AngleSpeedController'
 ******************************************************************************/





#define currentAngle_VAL (classes_AngleSpeedController_RAM.currentAngle)
#define dT_VAL (ASD_DT_SCALED)
#define errorAngleSum_VAL (classes_AngleSpeedController_RAM.errorAngleSum)
#define IntegratorKLimited_instance_REF (&(classes_AngleSpeedController.IntegratorKLimited_instance))
#define prevAngle_VAL (classes_AngleSpeedController_RAM.prevAngle)


/******************************************************************************
 * BEGIN: FUNCTIONS OF COMPONENT
 ******************************************************************************/


/******************************************************************************
 * BEGIN: DEFINITION OF PROCESS 'classes_AngleSpeedController_Automatic_calculateAngleSpeed'
 * ----------------------------------------------------------------------------
 * model name:...................................'calculateAngleSpeed'
 * memory class:.................................'CODE'
 * ---------------------------------------------------------------------------*/
/* messages used by this process */
#define AngleOutput__classes_AngleSpeedController_Automatic_calculateAngleSpeed (AngleOutput)
#define KiAngle__classes_AngleSpeedController_Automatic_calculateAngleSpeed (KiAngle)
#define KpAngle__classes_AngleSpeedController_Automatic_calculateAngleSpeed (KpAngle)
#define TargetAngle__classes_AngleSpeedController_Automatic_calculateAngleSpeed (TargetAngle)


void classes_AngleSpeedController_Automatic_calculateAngleSpeed (void)
{
   /* user defined local variables */
   float32 errorAngle;

   errorAngle
      = currentAngle_VAL - TargetAngle__classes_AngleSpeedController_Automatic_calculateAngleSpeed;
   SystemLib_Transferfunction_Integrator_IntegratorKLimited_Automatic_compute(IntegratorKLimited_instance_REF, errorAngle, 1.0F, -1.5F, 1.5F);
   errorAngleSum_VAL
      = SystemLib_Transferfunction_Integrator_IntegratorKLimited_Automatic_value(IntegratorKLimited_instance_REF);
   AngleOutput__classes_AngleSpeedController_Automatic_calculateAngleSpeed
      = (KpAngle__classes_AngleSpeedController_Automatic_calculateAngleSpeed * errorAngle) + (errorAngleSum_VAL * KiAngle__classes_AngleSpeedController_Automatic_calculateAngleSpeed);
}
/* ----------------------------------------------------------------------------
 * END: DEFINITION OF PROCESS 'classes_AngleSpeedController_Automatic_calculateAngleSpeed'
 ******************************************************************************/




/******************************************************************************
 * BEGIN: DEFINITION OF PROCESS 'classes_AngleSpeedController_Automatic_calculateInclinationAngle'
 * ----------------------------------------------------------------------------
 * model name:...................................'calculateInclinationAngle'
 * memory class:.................................'CODE'
 * ---------------------------------------------------------------------------*/
/* messages used by this process */
#define AccelerationY__classes_AngleSpeedController_Automatic_calculateInclinationAngle (AccelerationY)
#define AccelerationZ__classes_AngleSpeedController_Automatic_calculateInclinationAngle (AccelerationZ)
#define GyroX__classes_AngleSpeedController_Automatic_calculateInclinationAngle (GyroX)


void classes_AngleSpeedController_Automatic_calculateInclinationAngle (void)
{
   /* user defined local variables */
   float32 accAngle;
   float32 gyroAngle;
   float32 gyroRate;
   /* temp. variables */
   float32 _t1real32;
   float32 _t2real32;

   _t1real32
      = (float32)AccelerationY__classes_AngleSpeedController_Automatic_calculateInclinationAngle;
   _t2real32
      = (float32)AccelerationZ__classes_AngleSpeedController_Automatic_calculateInclinationAngle;
   accAngle
      = (float32)atan2((float64)_t1real32, (float64)_t2real32) * 57.3F;
   gyroRate
      = (float32)GyroX__classes_AngleSpeedController_Automatic_calculateInclinationAngle / 131.0F;
   gyroAngle = dT_VAL * gyroRate;
   currentAngle_VAL
      = ((prevAngle_VAL + gyroAngle) * 0.9934F) + (accAngle * 0.0066F);
   prevAngle_VAL = currentAngle_VAL;
}
/* ----------------------------------------------------------------------------
 * END: DEFINITION OF PROCESS 'classes_AngleSpeedController_Automatic_calculateInclinationAngle'
 ******************************************************************************/



/* ****************************************************************************
 * END: FUNCTIONS OF COMPONENT
 ******************************************************************************/



